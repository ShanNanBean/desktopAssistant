<Window x:Class="PowerShellHelper.Views.HistoryWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:vm="clr-namespace:PowerShellHelper.ViewModels"
        Title="åŽ†å²è®°å½•" 
        Height="600" Width="900"
        WindowStartupLocation="CenterOwner">
    
    <Window.DataContext>
        <vm:HistoryWindowViewModel/>
    </Window.DataContext>

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- æœç´¢æ  -->
        <Border Grid.Row="0" 
               Background="#F5F5F5" 
               BorderBrush="#E0E0E0"
               BorderThickness="0,0,0,1"
               Padding="15">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <TextBox Grid.Column="0"
                        Text="{Binding SearchKeyword, UpdateSourceTrigger=PropertyChanged}"
                        Padding="10"
                        FontSize="13"
                        VerticalAlignment="Center">
                    <TextBox.Style>
                        <Style TargetType="TextBox">
                            <Setter Property="Foreground" Value="#666"/>
                            <Style.Triggers>
                                <Trigger Property="Text" Value="">
                                    <Setter Property="Background">
                                        <Setter.Value>
                                            <VisualBrush Stretch="None" AlignmentX="Left">
                                                <VisualBrush.Visual>
                                                    <TextBlock Text="æœç´¢åŽ†å²è®°å½•..." 
                                                              Foreground="#BDBDBD" 
                                                              Margin="10,0,0,0"
                                                              FontSize="13"/>
                                                </VisualBrush.Visual>
                                            </VisualBrush>
                                        </Setter.Value>
                                    </Setter>
                                </Trigger>
                            </Style.Triggers>
                        </Style>
                    </TextBox.Style>
                </TextBox>

                <Button Grid.Column="1"
                       Content="ðŸ”„ åˆ·æ–°"
                       Command="{Binding RefreshCommand}"
                       Margin="10,0,0,0"
                       Padding="15,8"/>
            </Grid>
        </Border>

        <!-- åŽ†å²è®°å½•åˆ—è¡¨ -->
        <DataGrid Grid.Row="1"
                 ItemsSource="{Binding HistoryRecords}"
                 SelectedItem="{Binding SelectedRecord}"
                 AutoGenerateColumns="False"
                 IsReadOnly="True"
                 SelectionMode="Single"
                 GridLinesVisibility="Horizontal"
                 HeadersVisibility="Column"
                 RowHeight="60"
                 BorderThickness="0">
            
            <DataGrid.Columns>
                <DataGridTextColumn Header="æ—¶é—´" 
                                   Binding="{Binding Timestamp, StringFormat='{}{0:yyyy-MM-dd HH:mm:ss}'}"
                                   Width="150"/>
                
                <DataGridTextColumn Header="ç”¨æˆ·è¾“å…¥" 
                                   Binding="{Binding UserInput}"
                                   Width="200">
                    <DataGridTextColumn.ElementStyle>
                        <Style TargetType="TextBlock">
                            <Setter Property="TextWrapping" Value="Wrap"/>
                            <Setter Property="VerticalAlignment" Value="Center"/>
                        </Style>
                    </DataGridTextColumn.ElementStyle>
                </DataGridTextColumn>

                <DataGridTextColumn Header="ç”Ÿæˆå‘½ä»¤" 
                                   Binding="{Binding GeneratedCommand}"
                                   Width="*">
                    <DataGridTextColumn.ElementStyle>
                        <Style TargetType="TextBlock">
                            <Setter Property="FontFamily" Value="Consolas"/>
                            <Setter Property="TextWrapping" Value="Wrap"/>
                            <Setter Property="VerticalAlignment" Value="Center"/>
                        </Style>
                    </DataGridTextColumn.ElementStyle>
                </DataGridTextColumn>

                <DataGridTextColumn Header="çŠ¶æ€" 
                                   Binding="{Binding Status}"
                                   Width="80">
                    <DataGridTextColumn.ElementStyle>
                        <Style TargetType="TextBlock">
                            <Setter Property="HorizontalAlignment" Value="Center"/>
                            <Setter Property="VerticalAlignment" Value="Center"/>
                            <Style.Triggers>
                                <DataTrigger Binding="{Binding Status}" Value="Success">
                                    <Setter Property="Text" Value="âœ… æˆåŠŸ"/>
                                    <Setter Property="Foreground" Value="Green"/>
                                </DataTrigger>
                                <DataTrigger Binding="{Binding Status}" Value="Failed">
                                    <Setter Property="Text" Value="âŒ å¤±è´¥"/>
                                    <Setter Property="Foreground" Value="Red"/>
                                </DataTrigger>
                                <DataTrigger Binding="{Binding Status}" Value="Cancelled">
                                    <Setter Property="Text" Value="âš ï¸ å–æ¶ˆ"/>
                                    <Setter Property="Foreground" Value="Orange"/>
                                </DataTrigger>
                                <DataTrigger Binding="{Binding Status}" Value="NotExecuted">
                                    <Setter Property="Text" Value="âŠ˜ æœªæ‰§è¡Œ"/>
                                    <Setter Property="Foreground" Value="Gray"/>
                                </DataTrigger>
                            </Style.Triggers>
                        </Style>
                    </DataGridTextColumn.ElementStyle>
                </DataGridTextColumn>

                <DataGridTemplateColumn Header="æ“ä½œ" Width="150">
                    <DataGridTemplateColumn.CellTemplate>
                        <DataTemplate>
                            <StackPanel Orientation="Horizontal" 
                                       HorizontalAlignment="Center"
                                       VerticalAlignment="Center">
                                <Button Content="é‡æ–°æ‰§è¡Œ"
                                       Command="{Binding DataContext.ReExecuteCommand, RelativeSource={RelativeSource AncestorType=Window}}"
                                       CommandParameter="{Binding}"
                                       Padding="8,4"
                                       FontSize="11"
                                       Margin="0,0,5,0"/>
                                <Button Content="åˆ é™¤"
                                       Command="{Binding DataContext.DeleteCommand, RelativeSource={RelativeSource AncestorType=Window}}"
                                       CommandParameter="{Binding}"
                                       Padding="8,4"
                                       FontSize="11"
                                       Background="#F44336"/>
                            </StackPanel>
                        </DataTemplate>
                    </DataGridTemplateColumn.CellTemplate>
                </DataGridTemplateColumn>
            </DataGrid.Columns>
        </DataGrid>

        <!-- åº•éƒ¨æ“ä½œæ  -->
        <Border Grid.Row="2" 
               Background="#F5F5F5" 
               BorderBrush="#E0E0E0"
               BorderThickness="0,1,0,0"
               Padding="15">
            <StackPanel Orientation="Horizontal" HorizontalAlignment="Right">
                <TextBlock Text="{Binding HistoryRecords.Count, StringFormat='å…± {0} æ¡è®°å½•'}"
                          VerticalAlignment="Center"
                          Margin="0,0,20,0"
                          Foreground="#666"/>
                <Button Content="ðŸ“¤ å¯¼å‡º"
                       Command="{Binding ExportCommand}"
                       Padding="15,8"
                       Margin="0,0,10,0"/>
                <Button Content="ðŸ—‘ï¸ æ¸…ç©ºå…¨éƒ¨"
                       Command="{Binding ClearAllCommand}"
                       Padding="15,8"
                       Background="#F44336"/>
            </StackPanel>
        </Border>
    </Grid>
</Window>
